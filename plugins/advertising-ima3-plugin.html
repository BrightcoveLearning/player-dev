---
title: "Advertising with the IMA3 Plugin"
description: "This topic covers the use of the IMA plugin and how it can be implemented using Studio and through custom coding."
parent: "Plugins"
---

<h1>{{ page.title }}</h1>
<article class="bcls-article">
  <summary>{{ page.description }}</summary>
  <p>
    The IMA plugin integrates the Brightcove player with Google's Interactive Media Ads (IMA) for HTML5 version 3. This allows you to request and track VAST, VPAID and VMAP ads for your player. For details about Google IMA, see the <a href="https://developers.google.com/interactive-media-ads/docs/sdks/html5/v3/">Using the IMA HTML5 SDK Version 3</a> document.
  </p>
  <section class="bcls-section">
    <h2 id="Player_sample">Player sample</h2>
    <p>
      The sample video below demonstrates the use of the IMA Plugin. Play the video to see a pre-roll, a skippable mid-roll at 5 seconds, then finally a post-roll.
    </p>
    <video-js data-account="1752604059001"
 data-player="H1Qvsb12"
 data-embed="default"
 controls=""
 data-video-id="4607357817001"
 data-playlist-id=""
 data-application-id=""
 width="600" height="340"
 playsinline></video-js>
    <script src="https://players.brightcove.net/1752604059001/H1Qvsb12_default/index.min.js"></script>
  </section>
  <section class="bcls-section">
    <h2 id="Testing_the_ad_server">Testing the ad server</h2>
    <p>
      The first thing you should do is verify the validity of the ad tag you are planning to use. Be sure you have copied its URL and browse to the following page:
      <a target="_blank" rel="noopener noreferrer" href="https://developers.google.com/interactive-media-ads/docs/sdks/html5/vastinspector">Video Suite Inspector</a> (clicking this link will cause the page to open in a new window or tab).
    </p>
    <p>
      Paste your ad tag URL into the <strong translate="No">Input type</strong> form input field. Click <strong translate="No">Test Ad</strong> and you will see your ad(s) play, with the Google supplied video interspersed. If your ad tag is not working in this test environment, it will not work with Brightcove Player.
    </p>
    <aside class="bcls-aside bcls-aside--information"> Note: The VAST ad tag can be hosted by your ad provider, or you can copy the XML and host it on your own URL.
    </aside>
  </section>
  <section class="bcls-section">
    <h2 id="Implement_using_Players_module_advertising_section">Implement using Players module - Advertising section</h2>
    <p>
      In this section of the document you will use Studio to implement advertising using the <strong>Advertising</strong> section. In this case, you are limited to what options the form provides. If you wish to customize the implementation using some of the many available options that happen NOT to be provided in this section, use the <a href="#Implement_using_Players_module_plugins_section">Implement using Players module - <strong>Plugins</strong> section</a>, which provides the opportunity to supply options via JSON.
    </p>
    <div id="player" class="video-cloud-only"> <video-js data-account="20318290001" data-player="E16-WGGOe" data-embed="default" data-video-id="4043519495001" class="video-js" controls="" crossorigin="anonymous" width="640" height="360">&nbsp;</video-js>
      <script src="https://players.brightcove.net/20318290001/E16-WGGOe_default/index.min.js"></script>
    </div>
    <p>To implement the IMA Plugin using the Players module, follow these steps:</p>
    <ol class="bcls-tasklist">
      <li>Open the <strong>PLAYERS</strong> module and either create a new player or locate the player to which you wish to add advertising functionality.</li>
      <li>Click the link for the player to open the player's properties.</li>
      <li>Click <strong>Advertising</strong> in the left navigation menu.</li>
      <li>Check the <strong>Enable Client-Side (IMA)</strong> checkbox.</li>
      <li>Enter the <strong translate="No">Server URL</strong> for the ad server.</li>
      <li>
        Select the <strong translate="No">Request Ads</strong> setting.
        <ul>
          <li>
            <strong translate="No">On load</strong> - Ads are requested immediately when the player loads (this is normally the best experience for DFP / VPAID).
          </li>
          <li><strong translate="No">On play</strong> - The first ad request is delayed until playback is initiated.</li>
          <li>
            <strong translate="No">On demand</strong> - All ad requests will be initiated programmatically using the <code translate="No">player.ima3.adrequest()</code> method. This mode does not support preroll or postroll ads.
          </li>
          <li>
            <strong translate="No">On cue point</strong> - Ad requests will be initiated on a dispatched ad cue point. See the <a href="/advertising/displaying-ads-using-ad-cue-points.html">Displaying Ads Using Ad Cue Points</a> document for complete details.
          </li>
        </ul>
      </li>
      <li>
        Select the ad <strong translate="No">VPAID Mode</strong>. The VPAID Mode is used to enable VPAID 2 support in IMA ads.
        <ul>
          <li><strong translate="No">Enabled</strong> - Play VPAID ads in an iframe with a different domain</li>
          <li><strong translate="No">Insecure</strong> - Play VPAID ads in an iframe with the same domain</li>
          <li><strong translate="No">Disabled</strong> - VPAID ads throw an error</li>
        </ul>
      </li>
      <li>
        Set the <strong translate="No">Timeout</strong> value. This is the maximum amount of time to wait, in milliseconds, for an ad to initialize before playback.
      </li>
      <li>
        Make a choice for <strong>Hard timeouts</strong>. Unchecking this option could result in a slow loading advertisement interrupting video playback.
      </li>
      <li>
        Set the <strong>Maximum Number of Redirects</strong>. This specifies the maximum number of redirects before the subsequent redirects will be denied, and the ad load aborted. The number of redirects directly affects latency and thus user experience.
      </li>
      <li>For the <strong>Plugin Version</strong>, it is strongly recommended you use the latest version.</li>
      <li>
        View an example, completed form:
        <figure class="bcls-figure">
          <img class="bcls-image" alt="IMA3 properties in Studio" src="//learning-services-media.brightcove.com/doc-assets/player-development/advertising/ima3-plugin/studio-ima-plugin-props.png" />
        </figure>
      </li>
      <li>Click <strong>Save</strong>.</li>
      <li>To publish the player, click <strong>Publish &amp; Embed &gt; Publish Changes</strong>.</li>
      <li>To close the open dialog, click <strong>Close</strong>.</li>
    </ol>
    <p>
      When the changes to the advertising properties are saved, the IMA plugin will be configured as part of the Plugin settings. The JavaScript and CSS will be hidden since you added them via the <strong translate="No">Advertising</strong> section.
    </p>
    <p>
      The IMA plugin does support additional properties that are not available in this section of the UI. See the next section of this document for a way to use more configuration options.
    </p>
    <aside class="bcls-aside bcls-aside--tip"> Note: You may want to dynamically build the <code translate="No">serverUrl</code> at the client (which means the IMA3 plugin would already be initialized), for example after a user login. You can do this by setting that value to an empty string in the <strong translate="No">options</strong> <code translate="No">{ "serverUrl": "" }</code>, then later assign the value programmatically.
    </aside>
  </section>
  <section class="bcls-section">
    <h2 id="Implement_using_Players_module_plugins_section">Implement using Players module - Plugins section</h2>
    <p>
      If you wish to configure the IMA3 plugin beyond the options provided in the <strong>Advertising</strong> section, you can use the <strong>Plugins</strong> section, which provides a way to supply options via JSON.
    </p>
    <p>To implement the IMA3 Plugin you will add the function name of the plugin and the URLs to the plugin's JavaScript and CSS files:</p>
    <ol class="bcls-tasklist-restart">
      <li>Open the <strong>PLAYERS</strong> module and either create a new player or locate the player to which you wish to add the plugin.</li>
      <li>Click the link for the player to open the player's properties.</li>
      <li>Click <strong>Plugins</strong> in the left navigation menu.</li>
      <li>
        Next click <strong>Plugins</strong> from the three options.
        <figure class="bcls-figure">
          <img class="bcls-image" alt="Select Plugin" src="//learning-services-media.brightcove.com/doc-assets/general/players-plugin-options.png" />
        </figure>
      </li>
      <li>From the <strong>Add a Plugin</strong> select <strong>Custom Plugin</strong>.</li>
      <li>For the <strong>Plugin Name</strong> enter <code translate="No">ima3</code>.</li>
      <li>
        For the <strong>JavaScript</strong> URL, enter:
        <pre>
 <code class="language-json" translate="No">https://players.brightcove.net/videojs-ima3/3/videojs.ima3.min.js</code></pre>
      </li>
      <li>
        For the <strong>CSS</strong> URL, enter:
        <pre>
 <code class="language-json" translate="No">https://players.brightcove.net/videojs-ima3/3/videojs.ima3.min.css</code></pre>
      </li>
      <!-- ** choose one of the following two steps, delete the other ** -->
      <li>
        Enter the configuration options in the <strong>Options(JSON)</strong> text box.
        <pre class="line-numbers">
 <code class="language-json" translate="No">{ 
  "serverUrl": "//pubads.g.doubleclick.net/gampad/ads?sz=400x300&amp;iu=%2F6062...", 
  "timeout": 5000,
  "debug": true
}</code></pre>
      </li>
      <li>Click <strong>Save</strong>.</li>
      <li>To publish the player, click <strong>Publish &amp; Embed &gt; Publish Changes</strong>.</li>
      <li>To close the open dialog, click <strong>Close</strong>.</li>
    </ol>
  </section>
  <section class="bcls-section">
    <h2 id="JSON_vs_JavaScript_notation">JSON vs JavaScript notation</h2>
    <p>
      If you examine the <strong translate="No">Options</strong> section above, you see the configuration information is supplied in JSON format. If you are using code to implement your IMA3 plugin, the notation for setting options with JavaScript is slightly different.
    </p>
    <p>Here you see options in JSON format you could use in Studio:</p>
    <pre class="line-numbers">
<code class="language-json" translate="No">{ 
  "requestMode": "onload",
  "serverUrl": "//solutions.brightcove.com/bcls/brightcove-player/vmap/simple-vmap.xml?cust_params={mediainfo.ad_keys}", 
  "timeout": 5000
}</code></pre>
    <p>If you are using JavaScript to configure your options, the JSON format would work, but you could also use the JavaScript syntax as shown here:</p>
    <pre class="line-numbers">
<code class="language-javascript" translate="No">{
  requestMode: 'onload',
  serverUrl: '//solutions.brightcove.com/bcls/brightcove-player/vmap/simple-vmap', 
  timeout: 5000
}</code></pre>
  </section>
  <section class="bcls-section">
    <h2 id="Options">Options</h2>
    <p>
      The video.js IMA3 plugin is built on top of the <a href="https://github.com/brightcove/videojs-ads">video.js ads framework</a> and accepts any options that the ad framework provides. Take a look at the ad framework <a href="https://github.com/videojs/videojs-contrib-ads/blob/main/docs/index.md">README</a> for details on the current set of overrideable settings. Both the IMA plugin specific options and ad framework options are documented here.
    </p>
    <p>The options are:</p>
    <ul>
      <li><a href="#clickTrackingElement">clickTrackingElement</a></li>
      <li><a href="#debug">debug</a></li>
      <li><a href="#debugContribAds">debugContribAds</a></li>
      <li><a href="#disableCustomPlaybackForIOS10Plus">disableCustomPlaybackForIOS10Plus</a></li>
      <li><a href="#hardTimeouts">hardTimeouts</a></li>
      <li><a href="#ima3SdkSettings">ima3SdkSettings</a></li>
      <li><a href="#requestMode">requestMode</a></li>
      <li><a href="#serverUrl">serverUrl</a></li>
      <li><a href="#showVpaidControls">showVpaidControls</a></li>
      <li><a href="#timeout">timeout</a></li>
      <li><a href="#useMediaCuePoints">useMediaCuePoints</a></li>
      <li><a href="#usePlayerAutoplayHandling">usePlayerAutoplayHandling</a></li>
      <li><a href="#vpaidMode">vpaidMode</a></li>
    </ul>
    <h3 id="clickTrackingElement">clickTrackingElement</h3>
    <p>Type: <code translate="No">HTMLElement</code> Default Value: undefined</p>
    <p>
      If the HTML ad tech is being used in <a href="https://developers.google.com/web/fundamentals/design-and-ux/input/touch">custom ad playback</a> mode, this specifies an alternative HTML element to be used to track advertisement taps on devices that don't support input events over the video element. More details are available in the parameter documentation for the <a href="https://developers.google.com/interactive-media-ads/docs/sdks/html5/v3/reference/js/ima.AdDisplayContainer">IMA AdDisplayContainer</a>. If you provide a click tracking element, it is your responsibility to show and hide it at the appropriate times on the appropriate platforms. In most cases, it's best to leave this setting undefined and allow the plugin and IMA to manage ad interaction.
    </p>
    <h3 id="debug">debug</h3>
    <p>Type: <code translate="No">boolean</code> Default Value: <code translate="No">false</code></p>
    <p>
      If debug is set to true, the ads framework will output additional information about its current state during playback. This can be handy for diagnosing issues or unexpected behavior in an ad integration.
    </p>
    <p>This option is part of the ad framework and is configured as follows:</p>
    <pre class="line-numbers">
<code class="language-javascript" translate="No">player.ima3({ 
  debug: true
});</code></pre>
    <p>The following screenshot shows the extensive information displayed by turning debug on.</p>
    <figure class="bcls-figure">
      <img class="bcls-image" alt="debug output in console" src="//learning-services-media.brightcove.com/doc-assets/player-development/advertising/ima3-plugin/console-debug.png" />
    </figure>
    <h3 id="debugContribAds">debugContribAds</h3>
    <p>Type: <code translate="No">boolean</code> Default Value: <code translate="No">false</code></p>
    <p>Used to enable debug logging for videojs-contrib-ads. For ID3 <code translate="No">oncue</code> requests to work, the ID3 TXXX frame received must contain JSON data with the following fields:</p>
    <ul>
      <li>Ad cue tag format:
        <ul>
          <li>name: Required - must be the string <code translate="No">adCue</code></li>
          <li>id: Required - a unique value to identify the ad given that times are relative in live streams</li>
          <li>serverUrl: Optional - Override the <code translate="No">serverUrl</code> in the IMA3 config for this ad only</li>
          <li>duration: Optional - appended as a <code translate="No">breaklength</code> parameter to the server url</li>
        </ul>
        Example: <code translate="No">{"name": "adCue", "id": 123}</code>
      </li>
      <li>Ad cancellation tag format:
        <ul>
          <li>name: Required - must be the string value <code translate="No">adCancel</code></li>
          <li>id: Required - a unique value to identify the ad cancellation given that times are relative in live streams</li>
        </ul>
        Example: <code translate="No">{"name": "adCancel", "id": 234}</code>
      </li>
    </ul>
    <h3 id="disableCustomPlaybackForIOS10Plus">disableCustomPlaybackForIOS10Plus</h3>
    <p>Type: <code translate="No">boolean</code> Default Value: <code translate="No">false</code></p>
    <p>
      This property is part of the <code translate="No">ima3SdkSettings</code> object. It acts as a getter and setter to control whether to disable custom playback on iOS 10+ browsers. Behavior is as follows: </p>
    <ul>
      <li>
        When true, ads will play inline if the content video is inline, which enables skippable ads. However, the ad will stay inline and not support iOS's native fullscreen.
      </li>
      <li>When false, ads will play in the same player as your content.</li>
    </ul>
    <p>See the <a href="#skippable-ads">iOS skippable ads</a> section of this document for an example of usage of this setting.</p>
    <h3 id="hardTimeouts">hardTimeouts</h3>
    <p>Type: <code translate="No">boolean</code> Default Value: <code translate="No">true</code></p>
    <p>
      Abandon ads that finish loading after they have timed out. This will prevent slow preroll ads from interrupting after the <code translate="No">timeout</code> has elapsed and content video has begun playing.
    </p>
    <p>This option is part of the ad framework and is configured as follows:</p>
    <pre class="line-numbers">
<code class="language-javascript" translate="No">player.ima3({ 
  hardTimeouts: true
});</code></pre>
    <p>Setting this option to <code translate="No">false</code> will result in content flash before ads.</p>
    <h3 id="ima3SdkSettings">ima3SdkSettings</h3>
    <p>Type: <code translate="No">object</code> Default Value: undefined</p>
    <p>
      If provided, the properties of this object are used to set the page-level <a href="https://developers.google.com/interactive-media-ads/docs/sdks/html5/v3/reference/js/ima.ImaSdkSettings">Ima3SdkSettings</a> when the IMA SDK has finished loading. The properties of this object are expected to be the camel-cased equivalent of setter methods on the <a href="https://developers.google.com/interactive-media-ads/docs/sdks/html5/v3/reference/js/ima.ImaSdkSettings">SDK</a> settings object, minus the 'set'
      prefix. For example, if you provided this object when initializing the plugin: </p>
    <pre class="line-numbers">
<code class="language-javascript" translate="No">player.ima3({
  ima3SdkSettings: {
    'numRedirects': 3,
    'ppid': 'publisher-provided-id'
  }
}</code></pre>
    <p>Then the video.js IMA plugin would run code that looks something like this when IMA had loaded:</p>
    <pre class="line-numbers">
 <code class="language-javascript" translate="No">window.google.ima.ImaSdkSettings.setNumRedirects(3); window.google.ima.ImaSdkSettings.setPpid('publisher-provided-id');</code></pre>
    <h3 id="requestMode">requestMode</h3>
    <p>Type: <code translate="No">string</code> Default Value: <code translate="No">onload</code></p>
    <p>This option is part of the ad framework is configured as follows:</p>
    <pre class="line-numbers">
<code class="language-javascript" translate="No">player.ima3({ 
  requestMode: 'onplay'
});</code></pre>
    <p>There are four possible values for this option:</p>
    <ul>
      <li>
        <code translate="No">onload</code>: Ads are requested immediately when the player loads. This is normally the best experience for DFP / VPAID.
      </li>
      <li>
        <code translate="No">onplay</code>: The first ad request is delayed until playback is initiated. This is important for ad networks which consider ad requests to be plays, so you would not want an ad request before a play request. This will cause ads trafficked to eventually drop, or the customer will receive less for the ads shown.
      </li>
      <li>
        <code translate="No">ondemand</code>: Ads will only play when initiated using the <code translate="No">player.ima3.adrequest()</code> method manually. This mode does not support preroll or postroll ads.
      </li>
      <li>
        <code translate="No">oncue</code>:This option behaves differently depending upon if it is use with the <code translate="No">useMediaCuePoints</code> option.
        <h4>Using cue points with Video Cloud</h4>
        <p>
          You can create ad cue points for a video in Studio, then have an advertisement played when the cue point is triggered. For full details see the <a href="/advertising/displaying-ads-using-ad-cue-points.html">Display Ads Using Ad Cue Points</a> document.
        </p>
        <h4>Using cue points in a live stream</h4>
        <p>
          Ads are requested based on ID3 cue points in a live stream. For this type of request to function correctly, the ID3 TXXX frame received must contain JSON data with the following fields:
        </p>
        <ul>
          <li><code translate="No">name</code>: Required; must be the string value <code translate="No">adCue</code></li>
          <li><code translate="No">id</code>: Required; A unique value to identify the ad given that times are relative in live streams</li>
          <li><code translate="No">serverUrl</code>: Optional; Appended as a break length parameter to the server url</li>
          <li><code translate="No">duration</code>: Optional; ad duration</li>
        </ul>
        <p>Example:</p>
        <pre class="line-numbers">
 <code class="language-json" translate="No">{"name": "adCue", "id": 123}</code></pre>
        <p>
          You can also cancel ID3 cue points in a live stream created by an <code translate="No">adCue</code> by using <code translate="No">adCancel</code>. The following format must be used for the object sent: </p>
        <pre class="line-numbers">
 <code class="language-json" translate="No">{"name": "adCancel", "id": 123}</code></pre>
        <p>Both the <code translate="No">name</code> and <code translate="No">id</code> are required.</p>
        <ul>
          <li>Live ID3 ad cues are not supported on Android.</li>
          <li>Live ID3 ad cancellation cues are not supported on iOS.</li>
        </ul>
      </li>
    </ul>
    <h3 id="serverUrl">serverUrl</h3>
    <p>Type: <code translate="No">string</code> or <code translate="No">function</code></p>
    <p>Default Value (a generic Google ad):</p>
    <pre class="line-numbers">
 <code class="language-html" translate="No">//pubads.g.doubleclick.net/gampad/ads?sz=400x300&amp;iu=%2F6062%2Fiab_vast_samples&amp;ciu_szs=300x250%2C728x90&amp;gdfp_req=1&amp;env=vp&amp;output=xml_vast2&amp;unviewed_position_start=1&amp;url=[referrer_url]&amp;correlator=[timestamp]&amp;cust_params=iab_vast_samples%3Dlinear</code></pre>
    <p>
      Here, you will provide the URL to your ad server. This option can be configured in Brightcove Studio as shown above. You can also set the value in code.
      Two examples are shown next. (Remember, you should <a href="#Testing_the_ad_server">test the ad tag</a> on your server before trying to use it in the plugin.)
    </p>
    <p>If the value is a string, it represents the ad server URL from where ads are requested and can be set in code as follows:</p>
    <pre class="line-numbers">
<code class="language-javascript" translate="No">player.ima3({ 
  serverUrl: 'your ad server'
});</code></pre>
    <p>
      If the value is a function, the function parameter is a <code translate="No">callback</code> function that should be called with your server URL as the argument. This provides support for asynchronous processes such as header bidding. In the following example you see information from the <code translate="No">mediainfo</code> object used to determine which ads URL should be used based on an account ID: </p>
    <pre class="line-numbers">
<code class="language-javascript" translate="No">// Initialize IMA plugin 
myPlayer.ima3({
 serverUrl: function(callback) {
   if (myPlayer.mediainfo.id === '4034552795001') { 
     callback('https://pubads.g.doubleclick.net/.../url1'); 
   } else {
     callback('https://pubads.g.doubleclick.net/.../url2'); 
   }
 },
 requestMode: 'onload',
 debug: true,
 debugContribAds: true
});</code></pre>
    <h3 id="showVpaidControls">showVpaidControls</h3>
    <p>Type: <code translate="No">boolean</code> Default Value: <code translate="No">false</code></p>
    <p>
      Set to <code translate="No">true</code> to show custom Brightcove controls over VPAID ads. They may or may not work depending on the VPAID implementation, so Brightcove suggests testing this feature with your ads before enabling it in production.
    </p>
    <h3 id="timeout">timeout</h3>
    <p>Type: <code translate="No">number</code> Default Value: <code translate="No">4000</code></p>
    <p>The maximum amount of time, in milliseconds, to wait for ads to play before an ad break is skipped.</p>
    <p>This option is part of the ad framework is configured as follows:</p>
    <pre class="line-numbers">
 <code class="language-javascript" translate="No">player.ima3({ timeout: 5000
 });</code></pre>
    <p>
      In internal Brightcove testing it was found that four seconds seemed to be long enough to accommodate slow initialization in most cases, but still short enough that failures to initialize didn't look like failures of the player or content video.
    </p>
    <aside class="bcls-aside bcls-aside--tip"> Note: If you set the timeout in both Studio and in the plugin configuration in the HTML page using JavaScript, the JavaScript configuration will have precedence.
    </aside>
    <h3 id="useMediaCuePoints">useMediaCuePoints</h3>
    <p>Type: <code translate="No">boolean</code> Default Value: <code translate="No">false</code></p>
    <p>Enables the use of <strong translate="No">ad</strong> cue points (as defined in Studio) to trigger an ad to play.</p>
    <p>For Video Cloud ad cuepoints to be used to trigger ads, the following is required in the plugin configuration:</p>
    <ul>
      <li><code translate="No">useMediaCuePoints</code>: true</li>
      <li><code translate="No">requestMode</code>: The string <code translate="No">oncue</code></li>
      <li><code translate="No">serverUrl</code>: Must point to a valid VAST ad</li>
    </ul>
    <p>
      If you are using Studio to setup advertising, when you select <strong>On cue point</strong> the <code translate="No">useMediaCuePoints</code> and <code translate="No">requestMode</code> options will be set correctly for you.
    </p>
    <h3 id="usePlayerAutoplayHandling">usePlayerAutoplayHandling</h3>
    <p>Type: <code translate="No">boolean</code> Default Value: <code translate="No">false</code></p>
    <p>
      Set to <code translate="No">true</code> to use the Brightcove Player's core autoplay handling. Otherwise, uses the IMA3 Plugin's default autoplay handling.
    </p>
    <h3 id="vpaidMode">vpaidMode</h3>
    <p>Type: <code translate="No">string</code> Default Value: <code translate="No">ENABLED</code></p>
    <p>Specify VPAID 2 mode in the IMA HTML5 SDK.</p>
    <p>There are three possible values for this option:</p>
    <ul>
      <li><code translate="No">ENABLED</code>: Play VPAID ads in an iframe with a different domain.</li>
      <li><code translate="No">INSECURE</code>: Play VPAID ads in an iframe with the same domain.</li>
      <li><code translate="No">DISABLED</code>: VPAID ads throw an error.</li>
    </ul>
    <p>This option is configured as follows:</p>
    <pre class="line-numbers">
 <code class="language-javascript" translate="No">player.ima3({ vpaidMode: 'DISABLED'
 });</code></pre>
  </section>
  <section class="bcls-section">
    <h2 id="Properties">Properties</h2>
    <p>Only one property exists for the plugin:</p>
    <ul>
      <li>html5: This is the only ad tech that can be loaded when the plugin initializes.</li>
    </ul>
  </section>
  <section class="bcls-section">
    <h2 id="Ad_macros_and_the_serverUrl">Ad macros and the serverUrl</h2>
    <p>
      There are ad macros available to make your job easier when creating the ad server URL. These macros enable you to use variables in the server URL for which the IMA3 plugin will substitute appropriate values. For instance, the following server URL contains some of the variables: </p>
    <pre class="line-numbers">
 <code class="language-json" translate="No">{"serverUrl": "//myadserver.com/ad?video={mediainfo.id}&amp;duration={player.duration}"}</code></pre>
    <p>The IMA3 plugins would substitute in the appropriate values, and the server URL actually used would appear as follows:</p>
    <pre class="line-numbers">
 <code class="language-json" translate="No">{"serverUrl": "//myadserver.com/ad?video=12340001&amp;duration=60"}</code></pre>
    <p>The following is the complete list of variables for which substituted values will be used:</p>
    <table class="bcls-table">
      <thead class="bcls-table__head">
        <tr>
          <th style="width: 30%;">Macro</th>
          <th style="width: 60%;">Description</th>
        </tr>
      </thead>
      <tbody class="bcls-table__body">
        <tr>
          <td>{document.referrer}</td>
          <td>Referring page URL. <aside class="bcls-aside bcls-aside--tip">
              <p>Within the player iframe, <code translate="no">{document.referrer}</code> may not be able to determine the embedding site URL, as the value returned will depend on the referrer policy set by the browser and/or the site implementation. Notably Chrome now defaults to <strong>origin-when-cross-origin</strong> policy, which means <code translate="no">{document.referrer}</code> within the player frame will only get the origin. If you need the referrer to be available within the player, you can set a less restrictive policy on the iframe element, or pass the <code translate="no">pageURL</code> in a different way, such as a query parameter.</p>
              <p>For more information, see Mozilla's <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Referrer-Policy">Referrer-Policy</a> document.</p>
            </aside>
          </td>
        </tr>
        <tr>
          <td>{mediainfo.ad_keys}</td>
          <td>
            Free form text string that can be added and edited in the Media module of Studio; you should use the query parameter in the form
            <pre class="line-numbers">
 <code class="language-javascript" translate="No">cust_params={mediainfo.ad_keys}</code></pre>
          </td>
        </tr>
        <tr>
          <td>{mediainfo.description}</td>
          <td>Short description (250 chars max)</td>
        </tr>
        <tr>
          <td>{mediainfo.duration}</td>
          <td>Duration of the video as reported by Video Cloud</td>
        </tr>
        <tr>
          <td>{mediainfo.id}</td>
          <td>Video ID</td>
        </tr>
        <tr>
          <td>{mediainfo.name}</td>
          <td>Video title</td>
        </tr>
        <tr>
          <td>{mediainfo.reference_id}</td>
          <td>Reference ID</td>
        </tr>
        <tr>
          <td>{mediainfo.tags}</td>
          <td>Tags (metadata) associated with the video</td>
        </tr>
        <tr>
          <td>{player.duration}</td>
          <td>
            Duration of video as measured by player (possibly slightly different from <code translate="No">mediainfo.duration</code> and probably more accurate). Note that this returns 0 if video is not loaded. Be careful timing your ad request with this macro.
          </td>
        </tr>
        <tr>
          <td>{player.height}</td>
          <td>The current player height</td>
        </tr>
        <tr>
          <td>{player.id}</td>
          <td>Player ID</td>
        </tr>
        <tr>
          <td>{player.pageUrl}</td>
          <td>The page URL: Returns document referrer if in an iframe, otherwise window location.
            <aside class="bcls-aside bcls-aside--tip">
              <p>Within the player iframe, <code translate="no">{player.pageUrl}</code> may not be able to determine the embedding site URL, as the value returned will depend on the referrer policy set by the browser and/or the site implementation. Notably Chrome now defaults to <strong>origin-when-cross-origin</strong> policy, which means <code translate="no">{player.pageUrl}</code> within the player frame will only get the origin. If you need the referrer to be available within the player, you can set a less restrictive policy on the iframe element, or pass the <code translate="no">pageURL</code> in a different way, such as a query parameter.</p>
              <p>For more information, see Mozilla's <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Referrer-Policy">Referrer-Policy</a> document.</p>
            </aside>
          </td>
        </tr>
        <tr>
          <td>{player.width}</td>
          <td>The current player width</td>
        </tr>
        <tr>
          <td>{playlist.id}</td>
          <td>Pulled from playlistinfo object</td>
        </tr>
        <tr>
          <td>{playlist.name}</td>
          <td>Pulled from playlistinfo object</td>
        </tr>
        <tr>
          <td>{random}</td>
          <td>
            A random number 0-1 trillion (Used to create a unique impression. This prevents the ad from being cached in the browser and prevents impression discrepancies.)
          </td>
        </tr>
        <tr>
          <td>{timestamp}</td>
          <td>Current local time in milliseconds since 1/1/70</td>
        </tr>
        <tr>
          <td>{window.location.href}</td>
          <td>Current page URL</td>
        </tr>
      </tbody>
    </table>
    <aside class="bcls-aside bcls-aside--tip"> NOTE: When retrieving the parent URL of an iframe player or Gallery In-Page Experience, using <code translate="No">window.location.href</code> is recommended. The reason for this is that In-Page experiences using the standard embed code construct an iframe dynamically at run-time to avoid styling and scripting issues.
      Since the iframe is generated via JavaScript, it takes on the same <code class="notransalate">window.location</code> of the parent page and follows the same-origin policy. Browsers unfortunately treat <code class="notransalate">document.referrer</code> differently for these generated iframes. Chrome, Safari, and Opera all set <code class="notransalate">document.referrer</code> to the <code class="notransalate">window.location</code> of the parent page, but only in http (not https). Firefox follows the specs correctly and sets <code class="notransalate">document.referrer</code> to the referrer of the parent page. All browsers correctly set <code class="notransalate">document.referrer</code> to the referrer of the parent page in https.
    </aside>
    <h4>Default values and ad macros</h4>
    <p>
      You can give ad macros default values. A default value can be provided within a macro, in which case this value will be used where a variable is undefined. The syntax is:
    </p>
    <pre class="line-numbers">
 <code class="language-javascript" translate="No">{macro=default}</code></pre>
    <p>For instance,</p>
    <pre class="line-numbers">
 <code class="language-javascript" translate="No">http://example.com/ad/{pageVariable.adConf=1234}</code></pre>
    <p>would resolve to the following if <code translate="No">window.adConf</code> is undefined:</p>
    <pre class="line-numbers">
 <code class="language-javascript" translate="No">http://example.com/ad/1234</code></pre>
  </section>
  <section class="bcls-section">
    <h2 id="Dynamic_macros">Dynamic macros</h2>
    <p>Dynamic macros provide access to values in the following:</p>
    <ul>
      <li>The video's <code translate="No">customFields</code> object through the <code translate="No">mediainfo.customFields</code> variable.</li>
      <li>The DOM's <code translate="No">window</code> object through the <code translate="No">pageVariable</code> variable.</li>
    </ul>
    <p>For example, you could use the following in your ad request:</p>
    <pre class="line-numbers">
 <code class="language-html" translate="No">//myadserver.com/ad?l={<span class="bcls-highlight">pageVariable.navigator.language</span>}&amp;category={<span class="bcls-highlight">mediainfo.customFields.type</span>}</code></pre>
    <p>For the <code translate="No">pageVariable</code> values, only certain value types are allowed to be used, as shown in this table:</p>
    <table class="bcls-table">
      <thead class="bcls-table__head">
        <tr>
          <th>Type</th>
          <th>What Happens</th>
        </tr>
      </thead>
      <tbody class="bcls-table__body">
        <tr>
          <td>String</td>
          <td>Use without changes</td>
        </tr>
        <tr>
          <td>Number</td>
          <td>Converted to string automatically</td>
        </tr>
        <tr>
          <td>Boolean</td>
          <td>Converted to string automatically</td>
        </tr>
        <tr>
          <td>Null</td>
          <td>Returns the string <strong translate="No">null</strong></td>
        </tr>
        <tr>
          <td>Undefined</td>
          <td>Logs warning and returns empty string</td>
        </tr>
        <tr>
          <td>Other</td>
          <td>Logs warning and returns empty string</td>
        </tr>
      </tbody>
    </table>
  </section>
  <section class="bcls-section">
    <h2 id="Custom_ad_macros">Custom ad macros</h2>
    <p>
      Although the <strong translate="No">Dynamic macros</strong> technique described just above is the much preferred method to access specific information via macros, you may have defined custom values you use when requesting ads from your ad server that you cannot reach via dynamic macros. In this case, you can utilize your values by overriding the <code translate="No">adMacroReplacement()</code> method. When you override this method it allows you to pass your specialized values for the ad request.
    </p>
    <p>
      The following is an example of overriding the <code translate="No">adMacroReplacement()</code> method. In this example, the custom values are defined as part of the page DOM, thus enabling ad requests to be customized on a per page basis. In this example, <code translate="No">mySite.category</code> is the location where the ad request information is stored.
    </p>
    <pre class="line-numbers">
 <code class="language-javascript" translate="No">brightcovePlayer.ima3.adMacroReplacement = function (url) { <span class="bcls-highlight">  var parameters = { '{category}': mySite.category
 };</span>
 for (var i in parameters) {
 url = url.split(i).join(encodeURIComponent(parameters[i])); }
 return url;
 }</code></pre>
    <p>Using specific values will help clarify exactly what is happening. Assume your request URL to the ad server is the following:</p>
    <pre class="line-numbers">
 <code class="language-html" translate="No">//myadserver.com/myads?adWord={category}</code></pre>
    <p>
      And assume the value dynamically assigned to <code translate="No">mySite.category</code> in the page is the string <strong translate="No">fishing-pole</strong>. Then after your version of the <code translate="No">adMacroReplacement()</code> method is called your ad request URL would appear as:
    </p>
    <pre class="line-numbers">
 <code class="language-html" translate="No">//myadserver.com/myads?adWord=fishing-pole</code></pre>
    <p>
      To summarize, when you override the <code translate="No">adMacroReplacement()</code> method it allows you to use custom values as ad macros, and dynamically assign values to the URL ad request.
    </p>
  </section>
  <section class="bcls-section">
    <h2 id="Methods">Methods</h2>
    <p>
      When you need to interact with the IMA SDK you need to wait for the <code translate="No">ima3-ready</code> event to be dispatched before successful use of the SDK can take place. This includes the following two methods.
    </p>
    <h3>player.ima3.adrequest( )</h3>
    <p>
      Calling this method will create an on-demand adrequest immediately upon receiving an ad response. Invoking this method creates a new IMA adManager which means that any previous ad response information (for instance, a postroll ad returned in a previous VAST response) will be lost. Brightcove recommends that you only use this method in cases where up-front knowledge of ad timings isn't known or you will be making all ad calls on-demand. In all other cases, it makes sense to put all ad data in the initial VAST call on plugin initialization.
    </p>
    <p>The following are two important points to consider when using <code translate="No">player.ima3.adrequest( )</code>:</p>
    <ul>
      <li>The method is for use with the <strong translate="No">ondemand</strong> request mode only.</li>
      <li>The method is not recommended for prerolls as content will play before the ad request completes, resulting in a flash of content.</li>
    </ul>
    <h5>Parameters</h5>
    <ul>
      <li>
        <strong translate="No">adRequestUrl</strong> <code translate="No">String</code> Path to a VAST ad tag. You can and should pass relative URLs.
        This parameter is optional and the configured <code translate="No">serverUrl</code> is used if no parameter is passed.
      </li>
    </ul>
    <h5>Returns:</h5>
    <ul>
      <li>Nothing</li>
    </ul>
    <p>Example</p>
    <pre class="line-numbers">
 <code class="language-javascript" translate="No">player.ima3.adrequest('//pubads.g.doubleclick.net/gampad/ads?sz=640x360&amp;iu=/6062/iab_vast_samples/skippable&amp;ciu_szs=300x250,728x90&amp;impl=s&amp;gdfp_req=1&amp;env=vp&amp;output=xml_vast2&amp;unviewed_position_start=1&amp;url=[referrer_url]&amp;correlator=[timestamp]');</code></pre>
    <h3>player.ima3.setAdsRenderingSettings()</h3>
    <p>This method lets you set ads rendering settings for the IMA SDK for HTML5.</p>
    <p>
      If there is no Ads Manager yet, this method saves your settings and when an Ads Manager is created it uses the settings you provided. If an Ads Manager already exists, it is updated to use your settings. In either case, any new Ads Managers created in the future will also use the most recent settings you provided. You can create an <code translate="No">AdsRenderingSettings</code> object by accessing the IMA SDK directly.
      <a href="https://developers.google.com/interactive-media-ads/docs/sdks/android/v3/api/reference/com/google/ads/interactivemedia/v3/api/AdsRenderingSettings">A variety of settings are available.</a>
    </p>
    <h5>Parameters</h5>
    <ul>
      <li><strong translate="No">google.ima.AdsRenderingSettings</strong> object</li>
    </ul>
    <h5>Returns:</h5>
    <ul>
      <li>Nothing</li>
    </ul>
    <p>Example:</p>
    <pre class="line-numbers">
 <code class="language-javascript" translate="No">var adsRenderingSettings = new google.ima.AdsRenderingSettings(); adsRenderingSettings.bitrate = 2500;
 adsRenderingSettings.enablePreloading = true; player.ima3.setAdsRenderingSettings(adsRenderingSettings);</code></pre>
  </section>
  <section class="bcls-section">
    <h2 id="Googles_AdsManager">Google's AdsManager</h2>
    <p>
      There are methods and properties available from Google's <a href="https://developers.google.com/interactive-media-ads/docs/sdks/html5/v3/reference/js/ima.AdsManager">google.ima.AdsManager</a> Interface. You can use the interface's properties/methods that retrieve information. It is not advised to use the methods that perform actions, like <code translate="No">destroy</code>, <code translate="No">setAutoPlayAdBreaks</code> and <code translate="No">stop</code>. For example, one method you can use is shown here:
    </p>
    <h3>AdsManager.getRemainingTime</h3>
    <p>Type: <code translate="No">google.ima.AdsManager.getRemainingTime</code></p>
    <p>Usage: <code translate="No">myPlayer.ima3.adsManager.getRemainingTime()</code></p>
    <p>
      Calling this method returns the amount of time remaining for the current ad. If an ad isn't available or has finished playing, it returns -1. For more information see Google's
      <a href="https://developers.google.com/interactive-media-ads/docs/sdks/html5/v3/reference/js/ima.AdsManager#getRemainingTime">documentation</a> on the method.
    </p>
  </section>
  <section class="bcls-section">
    <h2 id="Accessing_the_IMA_SDK_directly">Accessing the IMA SDK directly</h2>
    <p>A number of IMA settings are available on the plugin object at runtime. For instance, to determine the ad ID you would use:</p>
    <pre class="line-numbers">
 <code class="language-javascript" translate="No">var adId = player.ima3.currentAd.getAdId();</code></pre>
    <p>
      Be careful interacting directly with these properties. Calling the wrong method can lead to unexpected results and failure of advertisements to play properly.
    </p>
    <h3>adsLoader</h3>
    <p>Type: <code translate="No">google.ima.AdsLoader</code></p>
    <p>
      The object used to create ads requests. See <a href="https://developers.google.com/interactive-media-ads/docs/sdks/html5/v3/reference/js#ima.AdsManager">ima.AdsLoader</a>. The Ads Loader may not be available until <code translate="No">adsready</code> has been fired by the plugin.
    </p>
    <h3>adsManager</h3>
    <p>Type: <code translate="No">google.ima.AdsManager</code></p>
    <p>
      The object responsible for playing ads. See <a href="https://developers.google.com/interactive-media-ads/docs/sdks/html5/v3/reference/js#ima.AdsManager">ima.AdsManager</a>. The Ads Manager is not available until <code translate="No">adsready</code> has been fired by the plugin.
    </p>
    <h3>adDisplayContainer</h3>
    <p>Type: <code translate="No">google.ima.AdDisplayContainer</code></p>
    <p>
      The object responsible for managing the display elements for ads. See <a href="https://developers.google.com/interactive-media-ads/docs/sdks/html5/v3/reference/js#ima.AdDisplayContainer">ima.AdDisplayContainer</a>. The Ads Display container may not be available until <code translate="No">adsready</code> has been fired by the plugin.
    </p>
    <h3>currentAd</h3>
    <p>Type: <code translate="No">google.ima.Ad</code></p>
    <p>
      When an ad is playing, an object that encapsulates information about the current ad. See <a href="https://developers.google.com/interactive-media-ads/docs/sdks/html5/v3/reference/js#ima.Ad">ima.Ad</a>.
    </p>
  </section>
  <section class="bcls-section">
    <h2 id="Events">Events</h2>
    <p>
      The plugin emits some custom event types during loading, initialization, and playback. You can listen for IMA3 and ad framework events just like you would any other event:
    </p>
    <pre class="line-numbers">
 <code class="language-javascript" translate="No">player.on('ima3error', function(event) { console.log('event', event);
 });</code></pre>
    <table class="bcls-table">
      <thead class="bcls-table__head">
        <tr>
          <th style="width: 35%;">Event</th>
          <th style="width: 65%;">Dispatched when:</th>
        </tr>
      </thead>
      <tbody class="bcls-table__body">
        <tr>
          <td>ima3-ready</td>
          <td>The ima3 plugin code has loaded and is ready load the IMA SDK.</td>
        </tr>